<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loopy: Fish Fairy</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module">
      const fallbackBase = "/Loopy/";
      const hostname = window.location.hostname;
      const isLocalHost = hostname === "localhost" || hostname === "127.0.0.1";
      const preferFallback = !isLocalHost && (hostname.endsWith("github.io") || window.location.pathname.startsWith("/Loopy/"));

      const showLoadError = (error) => {
        const app = document.getElementById("app");
        if (app) {
          app.textContent = "Loopy failed to load. Please hard refresh this page.";
          app.style.color = "#ffe7c9";
          app.style.padding = "24px";
          app.style.fontFamily = "monospace";
        }
        console.error("Loopy bootstrap failed", error);
      };

      const loadFallbackBuild = async () => {
        const cssLink = document.createElement("link");
        cssLink.rel = "stylesheet";
        cssLink.href = `${fallbackBase}assets/index.css`;
        document.head.appendChild(cssLink);
        await import(`${fallbackBase}assets/index.js`);
      };

      const runBootstrap = async () => {
        if (preferFallback) {
          try {
            await loadFallbackBuild();
          } catch (error) {
            showLoadError(error);
          }
          return;
        }

        import("/src/main.ts").catch(async (error) => {
          try {
            await loadFallbackBuild();
          } catch (fallbackError) {
            showLoadError(fallbackError);
          }
          console.warn("Primary source entry failed, using prebuilt fallback.", error);
        });
      };

      runBootstrap();
    </script>
  </body>
</html>
