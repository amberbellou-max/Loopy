import type {
  FoodSpawnRule,
  HazardRule,
  LevelDefinition,
  PredatorSpawnRule,
  WormholeRule,
} from "../types/gameTypes";

const food = (
  foodType: FoodSpawnRule["foodType"],
  x: number,
  y: number,
  count: number,
  spreadX: number,
  spreadY: number,
  movement: FoodSpawnRule["movement"],
): FoodSpawnRule => ({
  foodType,
  x,
  y,
  count,
  spreadX,
  spreadY,
  movement,
});

const predator = (
  x: number,
  y: number,
  count: number,
  spacing: number,
  speed: number,
  shootIntervalMs: number,
  projectileSpeed: number,
): PredatorSpawnRule => ({
  x,
  y,
  count,
  spacing,
  speed,
  shootIntervalMs,
  projectileSpeed,
});

const wormhole = (
  x: number,
  y: number,
  pullRadius: number,
  pullStrength: number,
  shootIntervalMs: number,
  projectileSpeed: number,
): WormholeRule => ({
  x,
  y,
  pullRadius,
  pullStrength,
  shootIntervalMs,
  projectileSpeed,
});

const hazard = (
  type: HazardRule["type"],
  x: number,
  y: number,
  width: number,
  height: number,
  damage: number,
): HazardRule => ({
  type,
  x,
  y,
  width,
  height,
  damage,
});

export const LEVELS: LevelDefinition[] = [
  {
    id: 1,
    biome: "jungle",
    quota: 6,
    timeLimitSec: 120,
    checkpointX: [700, 1500],
    exitGateX: 2400,
    playerStart: { x: 120, y: 360 },
    foods: [
      food("river_fish", 450, 260, 4, 240, 120, "drift"),
      food("river_fish", 1200, 420, 5, 260, 130, "drift"),
      food("grass_bite", 1800, 500, 4, 180, 80, "static"),
    ],
    predators: [],
    wormholes: [],
    hazards: [hazard("vine", 980, 560, 120, 30, 14)],
    milestone: false,
  },
  {
    id: 2,
    biome: "jungle",
    quota: 8,
    timeLimitSec: 125,
    checkpointX: [800, 1700],
    exitGateX: 2700,
    playerStart: { x: 120, y: 360 },
    foods: [
      food("river_fish", 500, 230, 4, 200, 120, "drift"),
      food("earth_hopper_fish", 1100, 520, 6, 240, 40, "hopper"),
      food("grass_bite", 1960, 480, 4, 220, 90, "static"),
    ],
    predators: [],
    wormholes: [],
    hazards: [hazard("vine", 1420, 560, 140, 30, 15)],
    milestone: false,
  },
  {
    id: 3,
    biome: "jungle",
    quota: 10,
    timeLimitSec: 125,
    checkpointX: [850, 1900],
    exitGateX: 2950,
    playerStart: { x: 120, y: 360 },
    foods: [
      food("river_fish", 520, 240, 5, 230, 100, "drift"),
      food("earth_hopper_fish", 1320, 510, 6, 260, 35, "hopper"),
      food("grass_bite", 2200, 470, 5, 220, 90, "static"),
    ],
    predators: [predator(1700, 250, 1, 80, 90, 1800, 260)],
    wormholes: [],
    hazards: [hazard("vine", 2050, 560, 160, 35, 15)],
    milestone: false,
  },
  {
    id: 4,
    biome: "jungle",
    quota: 12,
    timeLimitSec: 130,
    checkpointX: [950, 2100],
    exitGateX: 3250,
    playerStart: { x: 120, y: 360 },
    foods: [
      food("river_fish", 620, 220, 6, 250, 120, "drift"),
      food("earth_hopper_fish", 1460, 510, 6, 260, 30, "hopper"),
      food("grass_bite", 2600, 460, 5, 180, 80, "static"),
    ],
    predators: [predator(1700, 250, 2, 180, 95, 1700, 280)],
    wormholes: [wormhole(2300, 330, 190, 530, 2600, 210)],
    hazards: [
      hazard("vine", 1880, 560, 170, 35, 16),
      hazard("vine", 2790, 560, 170, 35, 16),
    ],
    milestone: true,
    unlocksAbility: "dash",
  },
  {
    id: 5,
    biome: "jungle",
    quota: 13,
    timeLimitSec: 130,
    checkpointX: [980, 2200, 3000],
    exitGateX: 3500,
    playerStart: { x: 120, y: 360 },
    foods: [
      food("river_fish", 640, 240, 5, 220, 120, "drift"),
      food("earth_hopper_fish", 1500, 500, 7, 300, 35, "hopper"),
      food("grass_bite", 2550, 460, 5, 220, 95, "static"),
      food("river_fish", 3120, 260, 4, 170, 110, "drift"),
    ],
    predators: [predator(1880, 240, 2, 160, 100, 1650, 300)],
    wormholes: [wormhole(2860, 300, 200, 560, 2450, 230)],
    hazards: [hazard("vine", 2340, 560, 170, 35, 17)],
    milestone: false,
  },
  {
    id: 6,
    biome: "jungle",
    quota: 14,
    timeLimitSec: 130,
    checkpointX: [1100, 2400, 3200],
    exitGateX: 3780,
    playerStart: { x: 120, y: 350 },
    foods: [
      food("river_fish", 680, 210, 6, 250, 130, "drift"),
      food("earth_hopper_fish", 1700, 510, 7, 260, 40, "hopper"),
      food("grass_bite", 2480, 470, 4, 170, 90, "static"),
      food("river_fish", 3330, 260, 4, 210, 110, "drift"),
    ],
    predators: [predator(2000, 240, 2, 170, 105, 1550, 300)],
    wormholes: [
      wormhole(2550, 300, 220, 620, 2300, 240),
      wormhole(3380, 360, 170, 500, 2600, 220),
    ],
    hazards: [hazard("vine", 2920, 560, 170, 35, 18)],
    milestone: false,
  },
  {
    id: 7,
    biome: "jungle",
    quota: 15,
    timeLimitSec: 132,
    checkpointX: [1100, 2500, 3500],
    exitGateX: 4080,
    playerStart: { x: 120, y: 350 },
    foods: [
      food("river_fish", 720, 230, 6, 230, 110, "drift"),
      food("earth_hopper_fish", 1720, 500, 8, 280, 45, "hopper"),
      food("grass_bite", 2650, 470, 5, 200, 90, "static"),
      food("river_fish", 3600, 260, 5, 200, 120, "drift"),
    ],
    predators: [
      predator(1960, 240, 2, 190, 108, 1500, 320),
      predator(3320, 240, 1, 80, 115, 1350, 340),
    ],
    wormholes: [wormhole(2860, 320, 230, 640, 2250, 250)],
    hazards: [
      hazard("vine", 2320, 560, 160, 35, 18),
      hazard("vine", 3760, 560, 140, 35, 18),
    ],
    milestone: false,
  },
  {
    id: 8,
    biome: "jungle",
    quota: 16,
    timeLimitSec: 135,
    checkpointX: [1250, 2700, 3700],
    exitGateX: 4350,
    playerStart: { x: 120, y: 350 },
    foods: [
      food("river_fish", 760, 210, 6, 240, 120, "drift"),
      food("earth_hopper_fish", 1840, 500, 8, 300, 45, "hopper"),
      food("grass_bite", 2820, 460, 5, 220, 95, "static"),
      food("river_fish", 3900, 250, 6, 230, 130, "drift"),
    ],
    predators: [
      predator(1920, 220, 2, 180, 110, 1400, 340),
      predator(3360, 220, 2, 170, 114, 1300, 360),
    ],
    wormholes: [
      wormhole(2360, 320, 220, 650, 2200, 255),
      wormhole(3650, 290, 220, 650, 2100, 260),
    ],
    hazards: [
      hazard("vine", 2250, 560, 170, 35, 19),
      hazard("vine", 3220, 560, 170, 35, 19),
      hazard("vine", 4110, 560, 170, 35, 19),
    ],
    milestone: true,
    unlocksAbility: "glide",
  },
  {
    id: 9,
    biome: "desert",
    quota: 16,
    timeLimitSec: 130,
    checkpointX: [1250, 2700, 3700],
    exitGateX: 4450,
    playerStart: { x: 120, y: 350 },
    foods: [
      food("locust", 820, 220, 8, 260, 140, "swarm"),
      food("locust", 1960, 260, 8, 320, 160, "swarm"),
      food("locust", 3260, 300, 7, 260, 140, "swarm"),
    ],
    predators: [
      predator(2080, 220, 2, 180, 120, 1300, 370),
      predator(3520, 220, 1, 70, 125, 1250, 380),
    ],
    wormholes: [wormhole(2900, 320, 220, 670, 2100, 270)],
    hazards: [hazard("sand_spike", 2460, 560, 170, 36, 20)],
    milestone: false,
  },
  {
    id: 10,
    biome: "desert",
    quota: 17,
    timeLimitSec: 130,
    checkpointX: [1320, 2820, 3900],
    exitGateX: 4600,
    playerStart: { x: 120, y: 350 },
    foods: [
      food("locust", 900, 200, 8, 290, 150, "swarm"),
      food("locust", 2140, 250, 8, 320, 160, "swarm"),
      food("locust", 3500, 290, 8, 280, 140, "swarm"),
    ],
    predators: [
      predator(2120, 230, 2, 180, 123, 1200, 390),
      predator(3600, 220, 2, 170, 128, 1150, 400),
    ],
    wormholes: [
      wormhole(2660, 300, 230, 680, 2000, 280),
      wormhole(3960, 340, 180, 560, 2300, 260),
    ],
    hazards: [
      hazard("sand_spike", 2320, 560, 160, 36, 20),
      hazard("sand_spike", 4140, 560, 160, 36, 20),
    ],
    milestone: false,
  },
  {
    id: 11,
    biome: "desert",
    quota: 18,
    timeLimitSec: 128,
    checkpointX: [1320, 2920, 4050],
    exitGateX: 4740,
    playerStart: { x: 120, y: 350 },
    foods: [
      food("locust", 940, 210, 9, 300, 150, "swarm"),
      food("locust", 2290, 250, 9, 330, 160, "swarm"),
      food("locust", 3690, 290, 8, 300, 150, "swarm"),
    ],
    predators: [
      predator(1960, 220, 2, 160, 128, 1120, 410),
      predator(3380, 220, 2, 170, 132, 1080, 420),
    ],
    wormholes: [
      wormhole(2540, 300, 230, 700, 1950, 290),
      wormhole(3140, 360, 200, 640, 2100, 270),
      wormhole(4180, 300, 200, 650, 2050, 280),
    ],
    hazards: [
      hazard("sand_spike", 2480, 560, 180, 40, 21),
      hazard("sand_spike", 3550, 560, 180, 40, 21),
    ],
    milestone: false,
  },
  {
    id: 12,
    biome: "desert",
    quota: 19,
    timeLimitSec: 128,
    checkpointX: [1420, 3050, 4180],
    exitGateX: 4920,
    playerStart: { x: 120, y: 350 },
    foods: [
      food("locust", 980, 210, 9, 320, 150, "swarm"),
      food("locust", 2380, 250, 9, 350, 170, "swarm"),
      food("locust", 3850, 300, 9, 320, 150, "swarm"),
    ],
    predators: [
      predator(1960, 220, 2, 160, 132, 1050, 430),
      predator(3400, 220, 2, 170, 136, 980, 440),
      predator(4260, 220, 1, 70, 138, 1000, 445),
    ],
    wormholes: [
      wormhole(2500, 300, 240, 710, 1900, 300),
      wormhole(3540, 330, 220, 700, 1900, 295),
      wormhole(4350, 290, 220, 700, 1850, 305),
    ],
    hazards: [
      hazard("sand_spike", 2260, 560, 170, 40, 22),
      hazard("sand_spike", 3220, 560, 170, 40, 22),
      hazard("sand_spike", 4620, 560, 170, 40, 22),
    ],
    milestone: true,
    unlocksAbility: "shockwave",
  },
  {
    id: 13,
    biome: "desert",
    quota: 20,
    timeLimitSec: 126,
    checkpointX: [1450, 3200, 4350],
    exitGateX: 5100,
    playerStart: { x: 120, y: 345 },
    foods: [
      food("locust", 980, 210, 10, 330, 160, "swarm"),
      food("locust", 2520, 260, 10, 350, 180, "swarm"),
      food("locust", 4040, 300, 9, 340, 160, "swarm"),
    ],
    predators: [
      predator(2120, 220, 2, 170, 138, 980, 445),
      predator(3550, 220, 2, 170, 141, 930, 455),
      predator(4540, 230, 1, 70, 144, 920, 460),
    ],
    wormholes: [
      wormhole(2680, 320, 250, 760, 1800, 320),
      wormhole(3780, 300, 240, 730, 1780, 320),
    ],
    hazards: [
      hazard("sand_spike", 2360, 560, 180, 42, 23),
      hazard("sand_spike", 3420, 560, 180, 42, 23),
      hazard("sand_spike", 4730, 560, 180, 42, 23),
    ],
    milestone: false,
  },
  {
    id: 14,
    biome: "desert",
    quota: 21,
    timeLimitSec: 125,
    checkpointX: [1500, 3300, 4500],
    exitGateX: 5250,
    playerStart: { x: 120, y: 345 },
    foods: [
      food("locust", 1020, 220, 10, 340, 170, "swarm"),
      food("locust", 2660, 250, 10, 360, 190, "swarm"),
      food("locust", 4220, 300, 10, 360, 170, "swarm"),
    ],
    predators: [
      predator(2240, 220, 2, 170, 142, 910, 470),
      predator(3680, 220, 2, 170, 145, 880, 475),
      predator(4780, 220, 2, 160, 148, 860, 480),
    ],
    wormholes: [
      wormhole(2700, 300, 250, 760, 1750, 325),
      wormhole(3440, 340, 220, 710, 1750, 315),
      wormhole(4400, 300, 240, 750, 1700, 325),
    ],
    hazards: [
      hazard("sand_spike", 2480, 560, 180, 42, 24),
      hazard("sand_spike", 3980, 560, 180, 42, 24),
      hazard("sand_spike", 4980, 560, 180, 42, 24),
    ],
    milestone: false,
  },
  {
    id: 15,
    biome: "desert",
    quota: 22,
    timeLimitSec: 124,
    checkpointX: [1580, 3450, 4650],
    exitGateX: 5420,
    playerStart: { x: 120, y: 345 },
    foods: [
      food("locust", 1080, 220, 11, 350, 180, "swarm"),
      food("locust", 2820, 250, 10, 380, 200, "swarm"),
      food("locust", 4380, 300, 10, 370, 170, "swarm"),
    ],
    predators: [
      predator(2260, 220, 2, 170, 148, 850, 490),
      predator(3740, 220, 2, 170, 150, 830, 500),
      predator(4920, 220, 2, 170, 152, 810, 505),
    ],
    wormholes: [
      wormhole(2700, 300, 260, 790, 1650, 335),
      wormhole(3580, 330, 240, 770, 1650, 330),
      wormhole(4520, 280, 250, 790, 1600, 340),
    ],
    hazards: [
      hazard("sand_spike", 2520, 560, 190, 45, 25),
      hazard("sand_spike", 3580, 560, 190, 45, 25),
      hazard("sand_spike", 5200, 560, 190, 45, 25),
    ],
    milestone: false,
  },
  {
    id: 16,
    biome: "desert",
    quota: 24,
    timeLimitSec: 125,
    checkpointX: [1600, 3600, 4900],
    exitGateX: 5600,
    playerStart: { x: 120, y: 345 },
    foods: [
      food("locust", 1180, 220, 11, 360, 180, "swarm"),
      food("locust", 2980, 250, 11, 390, 200, "swarm"),
      food("locust", 4620, 300, 11, 390, 180, "swarm"),
    ],
    predators: [
      predator(2380, 220, 2, 170, 154, 790, 510),
      predator(3920, 220, 3, 150, 156, 760, 520),
      predator(5100, 220, 2, 160, 160, 720, 530),
    ],
    wormholes: [
      wormhole(2820, 300, 270, 840, 1550, 350),
      wormhole(3740, 330, 260, 820, 1500, 350),
      wormhole(4700, 280, 260, 830, 1450, 360),
      wormhole(5350, 280, 250, 810, 1450, 350),
    ],
    hazards: [
      hazard("sand_spike", 2480, 560, 200, 45, 26),
      hazard("sand_spike", 3600, 560, 200, 45, 26),
      hazard("sand_spike", 4580, 560, 200, 45, 26),
      hazard("sand_spike", 5300, 560, 200, 45, 26),
    ],
    milestone: true,
    unlocksAbility: "phase_blink",
  },
];

export function getLevelById(levelId: number): LevelDefinition {
  const level = LEVELS.find((entry) => entry.id === levelId);
  if (!level) {
    throw new Error(`Unknown level id: ${levelId}`);
  }
  return level;
}
